import{_ as F}from"./EmptyState.vue_vue_type_script_setup_true_lang-Do_NLNOo.js";import{C as L,_ as N}from"./BaseButton.vue_vue_type_script_setup_true_lang-BheV5iJ5.js";import{d as A,y as j,z as R,c as E,a as h,e as g,F as S,r as D,p as O,b as l,A as G,t as w,n as T,B as W,C as X,D as H,E as J,h as B,o as K,g as P,j as k,u as b,x as C,k as M,l as Q,f as z,T as Y}from"./index-BTVEsdd2.js";import{_ as Z,I as ee}from"./ManageableItems.vue_vue_type_script_setup_true_lang-B93NhIvD.js";import{u as te,_ as se}from"./categoryStore-CuUzrNnL.js";import{u as ae}from"./transactionStore-CKwxT-Vb.js";import{f as re}from"./array-pxlSuadx.js";import{f as q,a as ne}from"./format-BOdMUDrb.js";import{a as oe}from"./index-CbWGplPa.js";const le={class:"flex flex-wrap gap-2"},ie=["id","name","value"],ce=["for"],ue=A({__name:"ItemCheck",props:j({data:{},formName:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(r){const i=r,c=R(r,"modelValue"),v=E(()=>{function x(f){return f.flatMap(u=>[{id:u.id,name:u.name},...u.items?x(u.items):[]])}return x(i.data)});return(x,f)=>(g(),h("div",le,[(g(!0),h(S,null,D(v.value,u=>(g(),h("div",{key:u.id,class:"inline-flex items-center border border-slate-200 bg-slate-50 rounded-md px-3 py-2"},[O(l("input",{type:"checkbox",id:u.id,name:i.formName,value:u.id,"onUpdate:modelValue":f[0]||(f[0]=y=>c.value=y),class:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"},null,8,ie),[[G,c.value]]),l("label",{for:u.id,class:"ml-2 text-sm font-medium text-slate-700"},w(u.name),9,ce)]))),128))]))}}),de={class:"flex gap-2 flex-wrap"},me=["onClick"],ge=A({__name:"ItemChips",props:{items:{},size:{}},emits:["select"],setup(r){const i=r,c=E(()=>{switch(i.size){case"xs":return"px-2 py-0.5 text-xs";case"sm":return"px-3 py-1 text-sm";default:return"px-4 py-1 text-base"}});return(v,x)=>(g(),h("div",de,[(g(!0),h(S,null,D(r.items,(f,u)=>(g(),h("span",{key:u,class:T(["bg-gray-200 rounded-full text-gray-700 cursor-pointer hover:bg-gray-300 transition",c.value]),onClick:y=>v.$emit("select",f)},w(f),11,me))),128))]))}}),fe={class:"divide-y divide-gray-100"},pe=["onClick"],ye={class:"text-sm text-gray-700 truncate"},he=A({__name:"ListTable",props:{columns:{},items:{}},emits:["selected"],setup(r,{emit:i}){const c=i;return(v,x)=>(g(),h("div",fe,[(g(!0),h(S,null,D(r.items,(f,u)=>(g(),h("div",{key:u,class:"flex flex-row py-2",onClick:y=>c("selected",f)},[(g(!0),h(S,null,D(r.columns,(y,n)=>(g(),h("div",{key:n,class:T(["px-2",[y.align==="right"?"text-right":"text-left",y.class??"",y.width?`w-${y.width}`:"flex-1"]])},[W(v.$slots,y.key,{item:f},()=>[l("div",ye,w(f[y.key]),1)])],2))),128))],8,pe))),128))]))}}),ve={class:"w-full"},xe={class:"relative w-full h-7 bg-gray-100 flex items-center"},be={class:"absolute left-2 text-black font-semibold"},we={class:"flex justify-between text-gray-600 text-sm mt-2"},_e=A({__name:"PercentageBar",props:{percent:{},leftValue:{},rightValue:{},leftClass:{},rightClass:{}},setup(r){const i=c=>new Intl.NumberFormat("id-ID").format(c);return(c,v)=>(g(),h("div",ve,[l("div",xe,[l("div",{class:"h-full bg-orange-400 transition-all duration-500",style:X({width:r.percent+"%"})},null,4),l("div",be,w(r.percent)+" % ",1)]),l("div",we,[l("span",{class:T(r.leftClass)},"Rp. "+w(i(r.leftValue)),3),l("span",{class:T(r.rightClass)},"Rp. "+w(i(r.rightValue)),3)])]))}}),ke=H("budgets",()=>{const r=J(),i=B([]),c=async n=>{const a=await r.getStore("budgets","readwrite");return new Promise((o,p)=>{const d=a.get(n);d.onsuccess=()=>o(d.result??null),d.onerror=()=>p(d.error)})},v=async()=>{const a=(await r.getStore("budgets","readwrite")).getAll();return new Promise(async(o,p)=>{a.onsuccess=async()=>{const d=a.result??[];i.value=d,o(i.value)},a.onerror=()=>p(a.error)})},x=async n=>{try{if(!n.meta?.categories?.length)throw new Error("Category is empty");if(n.meta?.balance<=0)throw new Error("Budget should have positive value");const a=await r.getStore("budgets","readwrite");return await new Promise((o,p)=>{const d=a.add(n);d.onsuccess=()=>o(),d.onerror=()=>p(d.error)}),i.value.push(n),{success:!0}}catch(a){return console.error("Add budget failed:",a),{success:!1,error:a}}},f=async(n,a)=>{try{if(!a.meta?.categories?.length)throw new Error("Category is empty");if(a.meta?.balance<=0)throw new Error("Budget should have positive value");const o=await r.getStore("budgets","readwrite"),p=await new Promise(($,I)=>{const _=o.get(n);_.onsuccess=()=>$(_.result),_.onerror=()=>I(_.error)});if(!p)return{success:!1,error:new Error("Budget not found")};const d={...p,...a};await new Promise(($,I)=>{const _=o.put(d);_.onsuccess=()=>$(),_.onerror=()=>I(_.error)});const V=i.value.findIndex($=>$.id===n);return V!==-1&&(i.value[V]=d),{success:!0}}catch(o){return console.error("Update budget failed:",o),{success:!1,error:o}}},u=async n=>{const a=await r.getStore("budgets","readwrite");try{return await new Promise((o,p)=>{const d=a.delete(n);d.onsuccess=()=>o(),d.onerror=()=>p(d.error)}),i.value=i.value.filter(o=>o.id!==n),{success:!0}}catch(o){return console.error("Remove budget failed:",o),{success:!1,error:o}}};function y(n,a){if(n<=0)throw new Error("Budget should have positive value");const o=n-a,p=a/n*100;return{remaining:o,percentUsed:parseFloat(p.toFixed(2)),used:a}}return{budget:i,fetchAll:v,getById:c,add:x,update:f,remove:u,calculateBudgetUsage:y}}),Ce={key:0,class:"absolute inset-0 z-50 flex flex-col bg-white p-5 space-y-2",id:"transaction-list"},$e={class:"space-y-2"},Ie={class:"flex items-center justify-between bg-gray-100 border border-gray-200 rounded-md p-3"},Ve={key:0,class:"flex flex-1 items-center"},Be={class:"flex flex-col gap-0.5"},Se={class:"text-sm font-medium text-black"},Te={class:"text-xs text-gray-400"},Ae={class:"font-bold"},Me={class:"text-xs text-gray-400"},je=A({__name:"BudgetPage",setup(r){const i=ae(),c=ke(),v=te(),x=B([]),f=B("Monthly"),u=B(""),[y,n]=oe(),a=B([]),o=[{key:"content"},{key:"amount",width:"30%",align:"right"}];function p(m){const e=v.categories.flatMap(t=>[{id:t.id,name:t.name},...t.items?t.items.map(U=>({id:U.id,name:U.name})):[]]),s=Object.fromEntries(e.map(t=>[t.id,t.name]));return m.map(t=>s[t])}function d(m){const e=re(v.categories),s=Object.fromEntries(e.map(t=>[t.id,t]));return m.map(t=>s[t])}function V(m){return a.value.filter(e=>m.includes(e.categoryId))}function $(m){let e=0;return V(m).forEach(s=>{e+=parseInt(s.amount)}),e}const I=E(()=>c.budget.map(m=>{const e=c.calculateBudgetUsage(m.meta?.balance,$(m.meta?.categories||[]));return{...m,subName:q(m.meta?.balance||0),items:[{id:m.id,name:"",meta:{...m.meta,calculation:{percentage:e.percentUsed,remaining:e.remaining,used:e.used}}}]}})),_=E(()=>{if(!I.value.length)return v.categories;const m=new Set(I.value.flatMap(s=>s.meta?.categories??[]));function e(s){return s.flatMap(t=>[...m.has(t.id)?[]:[{id:t.id,name:t.name}],...t.items?e(t.items):[]])}return e(v.categories)});return K(async()=>{c.fetchAll(),v.fetchAll(),await i.fetchAll().then(m=>{m.forEach(e=>{a.value=[...a.value,{type:e.type,title:e.notes,categoryId:e.category.id,category:e.category.name,amount:e.total,asset:e.asset.name,time:e.time}]})})}),(m,e)=>(g(),h(S,null,[b(y)?(g(),h("div",Ce)):P("",!0),k(Z,{data:I.value,fetchAll:b(c).fetchAll,getById:b(c).getById,add:b(c).add,update:b(c).update,remove:b(c).remove,"override-child-clicked":()=>b(n)(),onSelectedItem:e[3]||(e[3]=s=>u.value=s),"list-auto-open":!0},{form:C(({data:s})=>[k(N,{input:"",number:"plain",label:"Amount",name:"meta.balance","model-value":`${s?.meta?.balance??""}`},null,8,["model-value"]),k(N,{label:"Category","model-value":`${x.value.length?p(x.value):p(s?.meta?.categories??[])}`},{customInputTitle:C(()=>[...e[4]||(e[4]=[l("h4",{class:"font-medium mb-3 text-slate-500 text-md"},"Select category to bind with budget",-1)])]),customInput:C(()=>[k(ue,{data:[..._.value,...d(s?.meta?.categories??[]).map(t=>({id:t.id,name:t.name}))],modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=t=>x.value=t),formName:"meta.categories[]",onVnodeMounted:t=>x.value=s?.meta?.categories??[]},null,8,["data","modelValue","onVnodeMounted"])]),_:2},1032,["model-value"]),k(N,{label:"Cycle",modelValue:s?.meta?.cycle??f.value},{customInputTitle:C(()=>[...e[5]||(e[5]=[l("h4",{class:"font-medium mb-3 text-slate-500 text-md"},"Select Cycle",-1)])]),customInput:C(()=>[k(se,{class:"bg-slate-100 rounded-sm border-1 border-slate-200",formName:"meta.cycle",data:["Monthly","Daily","Weekly"],"onUpdate:selected":e[1]||(e[1]=t=>f.value=t.toString())})]),_:1},8,["modelValue"])]),spacesub:C(({data:s})=>[l("div",$e,[s.meta?.categories?.length?(g(),M(ge,{key:0,size:"xs",items:p(s.meta?.categories)},null,8,["items"])):P("",!0),k(_e,{percent:s.meta?.calculation?.percentage||0,leftValue:s.meta?.calculation?.used||0,rightValue:s.meta?.calculation?.remaining||0,"left-class":"font-medium text-red-400","right-class":"font-medium text-blue-500"},null,8,["percent","leftValue","rightValue"]),b(y)&&u.value.includes(s.id)?(g(),M(Y,{key:1,to:"#transaction-list"},[l("div",Ie,[e[6]||(e[6]=l("h5",{class:"text-slate-500"},"List Item",-1)),(g(),M(Q(b(L)),{class:"text-slate-400",onClick:e[2]||(e[2]=t=>b(n)())}))]),V(s.meta?.categories||[]).length?(g(),M(he,{key:1,columns:o,items:V(s.meta?.categories)},{content:C(({item:t})=>[l("div",Be,[l("div",Se,w(t.title),1),l("div",Te,[z(w(b(ne)(t.time))+" . ",1),l("span",Ae,w(t.category),1)])])]),amount:C(({item:t})=>[l("div",{class:T(["text-sm font-semibold",[t.type=="Pengeluaran"?"text-red-500":"text-blue-500"]])},[z(w(b(q)(t.amount))+" ",1),e[7]||(e[7]=l("br",null,null,-1)),l("span",Me,w(t.asset),1)],2)]),_:1},8,["items"])):(g(),h("div",Ve,[k(F,{message:"Belum ada transaksi",description:"Transaksi akan muncul di sini setelah Anda menambahkannya",icon:b(ee)},null,8,["icon"])]))])):P("",!0)])]),_:1},8,["data","fetchAll","getById","add","update","remove","override-child-clicked"])],64))}});export{je as default};
